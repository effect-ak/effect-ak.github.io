import{R as p,c as Je}from"./client.BJwxA_Ca.js";import{V as Ve,W as q,d as N,p as A,N as le,X as ce,Y as de,Z as D,_ as m,$ as he,a0 as h,a1 as O,a2 as Le,a3 as x,a4 as be,a5 as pe,a6 as Qe,a7 as Ge,a8 as f,a9 as E,aa as l,ab as fe,ac as R,ad as ge,ae as W,O as u,af as me,ag as ye,ah as xe,ai as we,aj as Se,ak as Xe,al as c,am as Ke,an as Ye,ao as Ze,ap as et,aq as tt,ar as st,as as rt,at as nt,au as it,av as at,aw as _,ax as ot,ay as te,az as ut,aA as lt,aB as ct,aC as ve,S as J,E as se,g as V,D as dt,b as re,B as ke,aD as ht,aE as bt,w as ne,aF as L,H as $,aG as Q,u as Ee,f as T,L as S,aH as pt,aI as ft,aJ as G,i as gt,aK as mt,l as yt,aL as xt,A as wt,F as St,G as vt,J as B,aM as kt,aN as X,aO as Et,aP as _t,aQ as Nt,x as _e,aR as Tt,aS as It,aT as Pt,aU as Bt,aV as Ft,aW as Ne,aX as K,aY as j,aZ as U,a_ as z,a$ as Ct,b0 as Te,b1 as jt,b2 as At,b3 as $t,K as a}from"./editor.CtDE6kzl.js";const ie=Symbol.for("effect/Brand/Refined"),Ht=()=>Object.assign(e=>e,{[ie]:ie,option:e=>q(e),either:e=>Ve(e),is:e=>!0}),ae=Symbol.for("effect/MutableList"),Ot={[ae]:ae,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const s=t.value;return t=t.next,{done:e,value:s}},return(s){return e||(e=!0),{done:!0,value:s}}}},toString(){return de(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(ce)}},[le](){return this.toJSON()},pipe(){return A(this,arguments)}},Rt=e=>({value:e,removed:!1,prev:void 0,next:void 0}),Wt=()=>{const e=Object.create(Ot);return e.head=void 0,e.tail=void 0,e._length=0,e},Ie=e=>Pe(e)===0,Pe=e=>e._length,Ut=N(2,(e,t)=>{const s=Rt(t);return e.head===void 0&&(e.head=s),e.tail===void 0||(e.tail.next=s,s.prev=e.tail),e.tail=s,e._length+=1,e}),zt=e=>{const t=e.head;if(t!==void 0)return Mt(e,t),t.value},Mt=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},oe=Symbol.for("effect/MutableQueue"),g=Symbol.for("effect/mutable/MutableQueue/Empty"),qt={[oe]:oe,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return de(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(ce)}},[le](){return this.toJSON()},pipe(){return A(this,arguments)}},Dt=e=>{const t=Object.create(qt);return t.queue=Wt(),t.capacity=e,t},Jt=()=>Dt(void 0),F=e=>Ie(e.queue),Be=N(2,(e,t)=>{const s=Pe(e.queue);return e.capacity!==void 0&&s===e.capacity?!1:(Ut(t)(e.queue),!0)}),Vt=N(2,(e,t)=>{const s=t[Symbol.iterator]();let r,n=m(),i=!0;for(;i&&(r=s.next())&&!r.done;)i=Be(r.value)(e);for(;r!=null&&!r.done;)n=D(r.value)(n),r=s.next();return he(n)}),Fe=N(2,(e,t)=>Ie(e.queue)?t:zt(e.queue)),Lt=N(2,(e,t)=>{let s=m(),r=0;for(;r<t;){const n=Fe(g)(e);if(n===g)break;s=D(n)(s),r+=1}return he(s)}),Qt=e=>{let t=e[0];for(let s=1;s<e.length;s++)t+=e[s]==="_"?e[++s].toUpperCase():e[s];return t},Gt="effect/QueueEnqueue",Xt=Symbol.for(Gt),Kt="effect/QueueDequeue",Ce=Symbol.for(Kt),Yt={_In:e=>e},je={_Out:e=>e},b=Symbol.for("effect/PubSub/AbsentValue"),Ae=(e,t)=>s=>{s.has(e)||s.set(e,new Set),s.get(e).add(t)},Zt=(e,t)=>s=>{if(!s.has(e))return;const r=s.get(e);r.delete(t),r.size===0&&s.delete(e)},es=e=>h(()=>{const t=ss(e);return ls(t,new gs)}),ts=e=>e.shutdown,ss=e=>new is(e?.replay?new xs(e.replay):void 0),rs=(e,t,s)=>x(be(),r=>ns(e,t,e.subscribe(),Jt(),r,pe(!1),s)),ns=(e,t,s,r,n,i,o)=>new os(e,t,s,r,n,i,o,e.replayWindow());class is{replayBuffer;publisherHead={value:b,subscribers:0,next:null};publisherTail=this.publisherHead;publisherIndex=0;subscribersIndex=0;capacity=Number.MAX_SAFE_INTEGER;constructor(t){this.replayBuffer=t}replayWindow(){return this.replayBuffer?new ws(this.replayBuffer):Ss}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const s=this.publisherTail.subscribers;return s!==0&&(this.publisherTail.next={value:t,subscribers:s,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const s of t)this.publish(s);else this.replayBuffer&&this.replayBuffer.offerAll(t);return m()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=b,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new as(this,this.publisherTail,this.publisherIndex,!1)}}class as{self;subscriberHead;subscriberIndex;unsubscribed;constructor(t,s,r,n){this.self=t,this.subscriberHead=s,this.subscriberIndex=r,this.unsubscribed=n}isEmpty(){if(this.unsubscribed)return!0;let t=!0,s=!0;for(;s;)this.subscriberHead===this.self.publisherTail?s=!1:this.subscriberHead.next.value!==b?(t=!1,s=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let s=!0,r=t;for(;s;)if(this.subscriberHead===this.self.publisherTail)s=!1;else{const n=this.subscriberHead.next.value;n!==b&&(r=n,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=b,this.self.subscribersIndex+=1),s=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const s=[],r=b;let n=0;for(;n!==t;){const i=this.poll(r);i===r?n=t:(s.push(i),n+=1)}return Ge(s)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==b&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=b,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class os extends rt{pubsub;subscribers;subscription;pollers;shutdownHook;shutdownFlag;strategy;replayWindow;[Ce]=je;constructor(t,s,r,n,i,o,d,y){super(),this.pubsub=t,this.subscribers=s,this.subscription=r,this.pollers=n,this.shutdownHook=i,this.shutdownFlag=o,this.strategy=d,this.replayWindow=y}commit(){return this.take}pipe(){return A(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!l(this.shutdownFlag)}get size(){return h(()=>l(this.shutdownFlag)?f:c(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return l(this.shutdownFlag)?fe():q(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return h(()=>l(this.shutdownFlag)?f:c(this.subscription.size()===this.capacity()))}get isEmpty(){return x(this.size,t=>t===0)}get shutdown(){return ge(W(t=>(me(this.shutdownFlag,!0),u(nt(Y(this.pollers),s=>ut(s,t.id()),!1),Se(E(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),xe(we(this.shutdownHook,void 0)),ye))))}get isShutdown(){return E(()=>l(this.shutdownFlag))}get awaitShutdown(){return R(this.shutdownHook)}get take(){return W(t=>{if(l(this.shutdownFlag))return f;if(this.replayWindow.remaining>0){const r=this.replayWindow.take();return c(r)}const s=F(this.pollers)?this.subscription.poll(g):g;if(s===g){const r=it(t.id());return u(h(()=>(u(this.pollers,Be(r)),u(this.subscribers,Ae(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),l(this.shutdownFlag)?f:R(r))),at(()=>E(()=>fs(this.pollers,r))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),c(s)})}get takeAll(){return h(()=>{if(l(this.shutdownFlag))return f;const t=F(this.pollers)?hs(this.subscription):m();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?c(_(this.replayWindow.takeAll(),t)):c(t)})}takeUpTo(t){return h(()=>{if(l(this.shutdownFlag))return f;let s;if(this.replayWindow.remaining>=t){const n=this.replayWindow.takeN(t);return c(n)}else this.replayWindow.remaining>0&&(s=this.replayWindow.takeAll(),t=t-s.length);const r=F(this.pollers)?bs(this.subscription,t):m();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),s?c(_(s,r)):c(r)})}takeBetween(t,s){return h(()=>$e(this,t,s,m()))}}const $e=(e,t,s,r)=>s<t?c(r):u(e.takeUpTo(s),O(n=>{const i=t-n.length;return i===1?u(e.take,x(o=>u(r,_(n),te(o)))):i>1?u(e.take,O(o=>$e(e,i-1,s-n.length-1,u(r,_(n),te(o))))):c(u(r,_(n)))}));class us{pubsub;subscribers;scope;shutdownHook;shutdownFlag;strategy;[Xt]=Yt;[Ce]=je;constructor(t,s,r,n,i,o){this.pubsub=t,this.subscribers=s,this.scope=r,this.shutdownHook=n,this.shutdownFlag=i,this.strategy=o}capacity(){return this.pubsub.capacity}get size(){return h(()=>l(this.shutdownFlag)?f:E(()=>this.pubsub.size()))}unsafeSize(){return l(this.shutdownFlag)?fe():q(this.pubsub.size())}get isFull(){return x(this.size,t=>t===this.capacity())}get isEmpty(){return x(this.size,t=>t===0)}get awaitShutdown(){return R(this.shutdownHook)}get isShutdown(){return E(()=>l(this.shutdownFlag))}get shutdown(){return ge(W(t=>(u(this.shutdownFlag,me(!0)),u(this.scope.close(Xe(t.id())),Se(this.strategy.shutdown),xe(we(this.shutdownHook,void 0)),ye))))}publish(t){return h(()=>l(this.shutdownFlag)?f:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),c(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,Ke(t),this.shutdownFlag))}isActive(){return!l(this.shutdownFlag)}unsafeOffer(t){return l(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return h(()=>{if(l(this.shutdownFlag))return f;const s=ps(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Ye(s)?c(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,s,this.shutdownFlag)})}get subscribe(){const t=Ze(et([this.scope.fork(tt),rs(this.pubsub,this.subscribers,this.strategy)]),s=>s[0].addFinalizer(()=>s[1].shutdown));return x(st(t,(s,r)=>s[0].close(r)),s=>s[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return A(this,arguments)}}const ls=(e,t)=>O(Le(),s=>x(be(),r=>cs(e,new Map,s,r,pe(!1),t))),cs=(e,t,s,r,n,i)=>new us(e,t,s,r,n,i),ds=(e,t)=>{ct(e,c(t))},He=(e,t)=>u(e,Vt(t)),Y=e=>u(e,Lt(Number.POSITIVE_INFINITY)),hs=e=>e.pollUpTo(Number.POSITIVE_INFINITY),bs=(e,t)=>e.pollUpTo(t),ps=(e,t)=>e.publishAll(t),fs=(e,t)=>{He(e,u(Y(e),ot(s=>s!==t)))};class gs{get shutdown(){return lt}handleSurplus(t,s,r,n){return c(!1)}unsafeOnPubSubEmptySpace(t,s){}unsafeCompletePollers(t,s,r,n){return ms(this,t,s,r,n)}unsafeCompleteSubscribers(t,s){return ys(this,t,s)}}const ms=(e,t,s,r,n)=>{let i=!0;for(;i&&!r.isEmpty();){const o=u(n,Fe(g));if(o===g)u(s,Zt(r,n)),F(n)?i=!1:u(s,Ae(r,n));else{const d=r.poll(g);d===g?He(n,u(Y(n),D(o))):(ds(o,d),e.unsafeOnPubSubEmptySpace(t,s))}}},ys=(e,t,s)=>{for(const[r,n]of s)for(const i of n)e.unsafeCompletePollers(t,s,r,i)};class xs{capacity;constructor(t){this.capacity=t}head={value:b,next:null};tail=this.head;size=0;index=0;slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:b,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const s of t)this.offer(s)}}class ws{buffer;head;index;remaining;constructor(t){this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return m();this.index<this.buffer.index&&this.fastForward();const s=Math.min(t,this.remaining),r=new Array(s);for(let n=0;n<s;n++){const i=this.head.value;this.head=this.head.next,r[n]=i}return this.remaining-=s,Qe(r)}takeAll(){return this.takeN(this.remaining)}}const Ss={remaining:0,take:()=>{},takeN:()=>m(),takeAll:()=>m()},vs=es,ks=ts,Es=Ht();class H extends ve()("BotStateProvider",{defaultValue:()=>Es({name:"nameless",status:"idle",token:"",isAutoReload:!1,isReachable:!1,currentCode:"",events:[]})}){}const _s="0.6.2",C="@effect-ak/tg-bot-client",ue="mjs",v="https://cdn.jsdelivr.net/npm",k=`${C}@${_s}/dist`,Ns=[{entryName:"index",packageName:C,dts_url:`${v}/${k}/index.d.ts`,js_url:`${v}/${k}/index.${ue}`},{entryName:"bot",packageName:C,dts_url:`${v}/${k}/bot.d.ts`,js_url:`${v}/${k}/bot-bundle.${ue}`},{entryName:"config-BFdBOrJI",packageName:C,dts_url:`${v}/${k}/config-BFdBOrJI.d.ts`}];class Oe extends J()("TgBotEditorProvider",{scoped:V(function*(t){const s=yield*se,r=yield*re,n=yield*ne("/bots/empty.ts"),i=yield*H;r.model.setValue(n),i.currentCode=n;const o=async d=>{console.log("setting code");const y=await ne(`/bots/${d}`).pipe($);r.model.setValue(y),i.currentCode=n};return yield*L(d=>(console.log("editor finalizer",d),Q)),{getCode:r.getCode,bindEditor:s.bindEditor,changeExample:o}}),dependencies:[se.Default.pipe(dt(re.typescript),ke(ht(bt,{packages:Ns})))]}){}const Ts=Ee("create pub sub")(function*(){const e=yield*vs();return yield*L(()=>ks(e)),e});class I extends J()("PlaygroundBusProvider",{scoped:Ts()}){}function Re(e){return!(e.type=="new-active-tab"||e.type=="from-worker"&&e.data.newBotState)}const Is=T({type:S("error-encounter"),error:G}),Ps=T({type:S("bot-code-changed"),new_code:G}),Bs=T({type:S("bot-is-connected")}),Fs=T({type:S("new-active-tab"),tabName:S("run","code")}),We=T({type:S("from-worker"),data:pt({key:G,value:mt}),message_id:gt});ft(Is,Ps,We,Bs,Fs);class Ue extends J()("BotWorkerProvider",{scoped:V(function*(t){yield*yt("worker up");const s=new Worker(new URL("/_astro/web-worker-Cx67JWPX.js",import.meta.url),{type:"module"}),r=yield*H;return yield*L(n=>(s.terminate(),console.log("terminating worker",n),Q)),s.addEventListener("message",n=>{console.log("message from worker",n.data);const i=xt(We)(n.data);if(i._tag!="Right"||!Re(i.right)){console.log("ignoring web worker event",n);return}r.events.push(i.right)}),{runBot(){s.postMessage({command:"run-bot",code:r.currentCode,token:r.token})}}}),dependencies:[I.Default]}){}const ze=p.createContext(null),Cs=wt(Oe.Default,I.Default,Ue.Default).pipe(ke(St)),js=vt(Cs),As=async()=>{const e=await js.runtimeEffect.pipe($),t=B(e.context,Oe),s=B(e.context,I),r=B(e.context,H);return{botWorker:B(e.context,Ue),eventBus:s,botState:r,editor:t,subscribe(i){console.log("subscribing...");const o=V(function*(){const y=yield*kt(),ee=yield*u(s.subscribe,X(Et,y)),qe=yield*u(ee.take,_e(i),Nt,_t(y));return{subscription:ee,fiber:qe,close:()=>u(Pt(y,Bt),It).then(De=>console.log("cleaning up scope",De))}}),{close:d}=Tt(o);return()=>{console.log("closing scope..."),d()}}}};var w=class extends Ft("TgBotClientError"){},$s=e=>typeof e=="object"&&e!=null&&"file_content"in e&&e.file_content instanceof Uint8Array&&"file_name"in e&&typeof e.file_name=="string",Hs=e=>typeof e=="object"&&e!=null&&"ok"in e&&typeof e.ok=="boolean",Os="https://api.telegram.org",Me=class extends ve()("TgBotApiBaseUrl",{defaultValue:()=>Os}){},Z=class extends Ne("TgBotApiToken")(){},Rs=e=>{let t=Object.entries(e);if(t.length==0)return;let s=new FormData;for(let[r,n]of t)n&&(typeof n!="object"?s.append(r,`${n}`):$s(n)?s.append(r,new Blob([n.file_content]),n.file_name):s.append(r,JSON.stringify(n)));return s},M=(e,t)=>K(function*(){let s=yield*j(Z),r=yield*j(Me),n=yield*U({try:()=>fetch(`${r}/bot${s}/${Qt(e)}`,{body:Rs(t)??null,method:"POST"}),catch:o=>new w({cause:{_tag:"ClientInternalError",cause:o}})}),i=yield*U({try:()=>n.json(),catch:()=>new w({cause:{_tag:"NotJsonResponse",response:n}})});return Hs(i)?n.ok?i.result:yield*z(new w({cause:{_tag:"NotOkResponse",...i.error_code?{errorCode:i.error_code}:void 0,...i.description?{details:i.description}:void 0}})):yield*z(new w({cause:{_tag:"UnexpectedResponse",response:i}}))}),Ws=({fileId:e,type:t})=>Us(e).pipe(Ct(({content:s,file_name:r})=>new File([s],r,{...t?{type:t}:void 0}))),Us=e=>K(function*(){let t=(yield*M("get_file",{file_id:e})).file_path;if(!t||t.length==0)return yield*z(new w({cause:{_tag:"UnableToGetFile",cause:"File path not defined"}}));let s=t.replaceAll("/","-"),r=yield*j(Me),n=yield*j(Z),i=`${r}/file/bot${n}/${t}`;return{content:yield*U({try:()=>fetch(i).then(o=>o.arrayBuffer()),catch:o=>new w({cause:{_tag:"UnableToGetFile",cause:o}})}),file_name:s}});(class extends Ne("ClientFileService")(){});K(function*(){return{getFile:Ws}});const zs=Ee("setup bot token")(function*(e){console.log("setup bot token");const t=yield*H,s=yield*I,r=yield*u($t({me:M("get_me",{}),webhook:M("get_webhook_info",{})},{concurrency:"unbounded"}),At(n=>s.offer({type:"error-encounter",error:n.toString()}).pipe(_e(Q))),Te(jt("1 second")));return r?r.webhook.url?(s.unsafeOffer({type:"error-encounter",error:"Cannot work with webhooks, delete it first"}),!1):(t.name=r.me.username??r.me.first_name,t.isReachable=!0,t.token=e,s.unsafeOffer({type:"bot-is-connected"}),!0):!1},(e,t)=>e.pipe(X(Z,t)));function Ms(){const e=P(),[t,s]=p.useState(e.botState);return{botState:t,setToken:async r=>{const n=await zs(r).pipe(X(I,e.eventBus),$);s({...e.botState}),n&&e.botWorker.runBot()}}}function P(){const e=p.useContext(ze);if(!e)throw Error("Playground context is undefined");return e}function qs(e){return a.jsx("button",{type:"button",className:"px-3 py-1 border rounded hover:bg-gray-200 active:bg-gray-300",onClick:()=>e.click(),children:a.jsx("i",{className:`fas fa-${e.icon}`})})}function Ds(){const{setToken:e,botState:t}=Ms(),[s,r]=p.useState(!1);if(t.token&&t.name){const i=`tg://resolve?domain=${t.name}`;return a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-green-700",children:"Connected:"}),a.jsxs("a",{className:"hover:text-blue-700",href:i,children:["@",t.name]})]})}const n=async()=>{const i=prompt("Enter your Telegram bot token (from BotFather) to connect the bot");i&&(r(!0),await e(i),r(!1))};return a.jsxs("div",{className:"flex gap-2",children:[!s&&a.jsx("span",{className:"text-lg text-red-600",children:"Not connected"}),s&&a.jsxs("span",{className:"text-lg",children:["Connecting... ",a.jsx("i",{className:"fas fa-cog fa-spin"})]}),!s&&a.jsx(qs,{icon:"plug",click:n})]})}function Js(){const e=P(),[t,s]=p.useState(e.botState.events);return p.useEffect(()=>{e.editor.getCode().pipe(Te(n=>{e.botState.currentCode=n,e.botState.isReachable&&e.botWorker.runBot()}),$);const r=e.subscribe(n=>{Re(n)&&(s(i=>[...i,n]),e.botState.events.push(n))});return()=>{console.log("leaving run tab"),r()}},[e]),a.jsxs("div",{id:"run",className:"flex flex-col h-full",children:[a.jsx("div",{className:"flex mb-2 text-sm gap-2",children:a.jsx(Ds,{})}),a.jsx("div",{className:"flex flex-1 flex-col items-start justify-start overflow-y-auto hide-scrollbar border border-gray-400 bg-indigo-50",children:t.map((r,n)=>a.jsx("div",{className:"w-full px-4 py-2 text-sm whitespace-pre-wrap text-black border-b-black border-b border-dotted",children:JSON.stringify(r)},n))})]})}function Vs(){const e=P();return p.useEffect(()=>{const t=e.editor.bindEditor();return t.layout({height:500,width:10}),()=>{t.dispose()}},[e]),a.jsx("div",{id:"code-editor",className:"border border-gray-400"})}function Ls(){const{eventBus:e}=P(),[t,s]=p.useState("code"),r=["code","run"];function n(i){s(i),e.unsafeOffer({type:"new-active-tab",tabName:i})}return a.jsxs("div",{className:"flex gap-2.5 h-full",children:[a.jsx("div",{className:"w-20",children:r.map(i=>a.jsx("button",{className:`transition block mb-2 px-4 py-2 rounded ${t===i?"bg-gray-200":"hover:bg-gray-200"}`,onClick:()=>n(i),children:i},i))}),a.jsxs("div",{className:"flex flex-1 flex-col w-full h-[600px]",children:[t==="code"&&a.jsx(Vs,{}),t==="run"&&a.jsx(Js,{})]})]})}function Qs(){const[e,t]=p.useState("empty.ts"),s=P(),r=n=>{const i=n.target.value;t(i),s.editor.changeExample(i)};return a.jsx("div",{className:"flex items-start gap-2.5 mb-4",children:a.jsxs("label",{className:"flex items-center gap-2",children:["Select example",a.jsxs("select",{className:"px-2 py-1 border border-gray-300 rounded bg-white",value:e,onChange:r,children:[a.jsx("option",{value:"empty.ts",children:"Simple Bot"}),a.jsx("option",{value:"command.ts",children:"Command Bot"}),a.jsx("option",{value:"file.ts",children:"File Bot"})]})]})})}function Gs(){return a.jsxs(a.Fragment,{children:[a.jsx(Qs,{}),a.jsx(Ls,{})]})}function Xs(e){const t=document.getElementById("playground");if(!t){console.warn("root div container");return}Je.createRoot(t).render(a.jsx(p.StrictMode,{children:a.jsx(ze,{value:e,children:a.jsx(Gs,{})})}))}const Ks=await As();Xs(Ks);
