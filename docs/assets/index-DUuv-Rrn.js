var Qe=Object.defineProperty;var Ke=(e,t,s)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var o=(e,t,s)=>Ke(e,typeof t!="symbol"?t+"":t,s);import{s as L,r as Xe,d as N,f as be,t as pe,N as fe,p as H,a as j,b as me,e as g,c as b,g as Ye,h as U,i as Ze,m as w,j as ge,k as ye,u as et,l as c,n as f,o as k,q as we,v as W,w as xe,x as z,y as l,z as Se,A as Ee,B as ve,C as ke,D as _e,E as tt,F as d,G as st,H as rt,I as nt,J as it,K as at,L as ot,M as ut,O as lt,P as ct,Q as dt,R as _,S as te,T as ht,U as bt,V as pt,W as ft,X as Ne,Y as V,Z as J,_ as se,$ as mt,a0 as re,a1 as Te,a2 as gt,a3 as yt,a4 as ne,a5 as G,a6 as R,a7 as Q,a8 as Ce,a9 as T,aa as S,ab as K,ac as wt,ad as xt,ae as St,af as Et,ag as vt,ah as kt,ai as a,aj as _t,ak as Nt,al as Tt,am as P,an as Ct,ao as X,ap as Bt,aq as It,ar as Pt,as as Be,at as Ft,au as $t,av as At,aw as Ht,ax as Rt,ay as Ot,az as Ut,aA as Ie,aB as Y,aC as A,aD as M,aE as q,aF as Wt,aG as Pe,aH as zt,aI as Mt,aJ as qt,aK as Dt,aL as Lt}from"./footer-D8e24wrQ.js";const ie=Symbol.for("effect/Brand/Refined"),jt=()=>Object.assign(e=>e,{[ie]:ie,option:e=>L(e),either:e=>Xe(e),is:e=>!0}),ae=Symbol.for("effect/MutableList"),Vt={[ae]:ae,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const s=t.value;return t=t.next,{done:e,value:s}},return(s){return e||(e=!0),{done:!0,value:s}}}},toString(){return be(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(pe)}},[fe](){return this.toJSON()},pipe(){return H(this,arguments)}},Jt=e=>({value:e,removed:!1,prev:void 0,next:void 0}),Gt=()=>{const e=Object.create(Vt);return e.head=void 0,e.tail=void 0,e._length=0,e},Fe=e=>$e(e)===0,$e=e=>e._length,Qt=N(2,(e,t)=>{const s=Jt(t);return e.head===void 0&&(e.head=s),e.tail===void 0||(e.tail.next=s,s.prev=e.tail),e.tail=s,e._length+=1,e}),Kt=e=>{const t=e.head;if(t!==void 0)return Xt(e,t),t.value},Xt=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},oe=Symbol.for("effect/MutableQueue"),m=Symbol.for("effect/mutable/MutableQueue/Empty"),Yt={[oe]:oe,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return be(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(pe)}},[fe](){return this.toJSON()},pipe(){return H(this,arguments)}},Zt=e=>{const t=Object.create(Yt);return t.queue=Gt(),t.capacity=e,t},es=()=>Zt(void 0),F=e=>Fe(e.queue),Ae=N(2,(e,t)=>{const s=$e(e.queue);return e.capacity!==void 0&&s===e.capacity?!1:(Qt(t)(e.queue),!0)}),ts=N(2,(e,t)=>{const s=t[Symbol.iterator]();let r,n=g(),i=!0;for(;i&&(r=s.next())&&!r.done;)i=Ae(r.value)(e);for(;r!=null&&!r.done;)n=j(r.value)(n),r=s.next();return me(n)}),He=N(2,(e,t)=>Fe(e.queue)?t:Kt(e.queue)),ss=N(2,(e,t)=>{let s=g(),r=0;for(;r<t;){const n=He(m)(e);if(n===m)break;s=j(n)(s),r+=1}return me(s)}),rs=e=>{let t=e[0];for(let s=1;s<e.length;s++)t+=e[s]==="_"?e[++s].toUpperCase():e[s];return t},ns="effect/QueueEnqueue",is=Symbol.for(ns),as="effect/QueueDequeue",Re=Symbol.for(as),os={_In:e=>e},Oe={_Out:e=>e},p=Symbol.for("effect/PubSub/AbsentValue"),Ue=(e,t)=>s=>{s.has(e)||s.set(e,new Set),s.get(e).add(t)},us=(e,t)=>s=>{if(!s.has(e))return;const r=s.get(e);r.delete(t),r.size===0&&s.delete(e)},ls=e=>b(()=>{const t=ds(e);return ys(t,new _s)}),cs=e=>e.shutdown,ds=e=>new ps(e!=null&&e.replay?new Cs(e.replay):void 0),hs=(e,t,s)=>w(ge(),r=>bs(e,t,e.subscribe(),es(),r,ye(!1),s)),bs=(e,t,s,r,n,i,u)=>new ms(e,t,s,r,n,i,u,e.replayWindow());class ps{constructor(t){o(this,"replayBuffer");o(this,"publisherHead",{value:p,subscribers:0,next:null});o(this,"publisherTail",this.publisherHead);o(this,"publisherIndex",0);o(this,"subscribersIndex",0);o(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new Bs(this.replayBuffer):Is}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const s=this.publisherTail.subscribers;return s!==0&&(this.publisherTail.next={value:t,subscribers:s,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const s of t)this.publish(s);else this.replayBuffer&&this.replayBuffer.offerAll(t);return g()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=p,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new fs(this,this.publisherTail,this.publisherIndex,!1)}}class fs{constructor(t,s,r,n){o(this,"self");o(this,"subscriberHead");o(this,"subscriberIndex");o(this,"unsubscribed");this.self=t,this.subscriberHead=s,this.subscriberIndex=r,this.unsubscribed=n}isEmpty(){if(this.unsubscribed)return!0;let t=!0,s=!0;for(;s;)this.subscriberHead===this.self.publisherTail?s=!1:this.subscriberHead.next.value!==p?(t=!1,s=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let s=!0,r=t;for(;s;)if(this.subscriberHead===this.self.publisherTail)s=!1;else{const n=this.subscriberHead.next.value;n!==p&&(r=n,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=p,this.self.subscribersIndex+=1),s=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const s=[],r=p;let n=0;for(;n!==t;){const i=this.poll(r);i===r?n=t:(s.push(i),n+=1)}return Ye(s)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==p&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=p,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}var le,ce;class ms extends(ce=ut,le=Re,ce){constructor(s,r,n,i,u,h,y,I){super();o(this,"pubsub");o(this,"subscribers");o(this,"subscription");o(this,"pollers");o(this,"shutdownHook");o(this,"shutdownFlag");o(this,"strategy");o(this,"replayWindow");o(this,le,Oe);this.pubsub=s,this.subscribers=r,this.subscription=n,this.pollers=i,this.shutdownHook=u,this.shutdownFlag=h,this.strategy=y,this.replayWindow=I}commit(){return this.take}pipe(){return H(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!c(this.shutdownFlag)}get size(){return b(()=>c(this.shutdownFlag)?f:d(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return c(this.shutdownFlag)?we():L(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return b(()=>c(this.shutdownFlag)?f:d(this.subscription.size()===this.capacity()))}get isEmpty(){return w(this.size,s=>s===0)}get shutdown(){return xe(z(s=>(Se(this.shutdownFlag,!0),l(lt(Z(this.pollers),r=>ft(r,s.id()),!1),_e(k(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),ve(ke(this.shutdownHook,void 0)),Ee))))}get isShutdown(){return k(()=>c(this.shutdownFlag))}get awaitShutdown(){return W(this.shutdownHook)}get take(){return z(s=>{if(c(this.shutdownFlag))return f;if(this.replayWindow.remaining>0){const n=this.replayWindow.take();return d(n)}const r=F(this.pollers)?this.subscription.poll(m):m;if(r===m){const n=ct(s.id());return l(b(()=>(l(this.pollers,Ae(n)),l(this.subscribers,Ue(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),c(this.shutdownFlag)?f:W(n))),dt(()=>k(()=>ks(this.pollers,n))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),d(r)})}get takeAll(){return b(()=>{if(c(this.shutdownFlag))return f;const s=F(this.pollers)?Ss(this.subscription):g();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?d(_(this.replayWindow.takeAll(),s)):d(s)})}takeUpTo(s){return b(()=>{if(c(this.shutdownFlag))return f;let r;if(this.replayWindow.remaining>=s){const i=this.replayWindow.takeN(s);return d(i)}else this.replayWindow.remaining>0&&(r=this.replayWindow.takeAll(),s=s-r.length);const n=F(this.pollers)?Es(this.subscription,s):g();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),r?d(_(r,n)):d(n)})}takeBetween(s,r){return b(()=>We(this,s,r,g()))}}const We=(e,t,s,r)=>s<t?d(r):l(e.takeUpTo(s),U(n=>{const i=t-n.length;return i===1?l(e.take,w(u=>l(r,_(n),te(u)))):i>1?l(e.take,U(u=>We(e,i-1,s-n.length-1,l(r,_(n),te(u))))):d(l(r,_(n)))}));var de,he;he=is,de=Re;class gs{constructor(t,s,r,n,i,u){o(this,"pubsub");o(this,"subscribers");o(this,"scope");o(this,"shutdownHook");o(this,"shutdownFlag");o(this,"strategy");o(this,he,os);o(this,de,Oe);this.pubsub=t,this.subscribers=s,this.scope=r,this.shutdownHook=n,this.shutdownFlag=i,this.strategy=u}capacity(){return this.pubsub.capacity}get size(){return b(()=>c(this.shutdownFlag)?f:k(()=>this.pubsub.size()))}unsafeSize(){return c(this.shutdownFlag)?we():L(this.pubsub.size())}get isFull(){return w(this.size,t=>t===this.capacity())}get isEmpty(){return w(this.size,t=>t===0)}get awaitShutdown(){return W(this.shutdownHook)}get isShutdown(){return k(()=>c(this.shutdownFlag))}get shutdown(){return xe(z(t=>(l(this.shutdownFlag,Se(!0)),l(this.scope.close(tt(t.id())),_e(this.strategy.shutdown),ve(ke(this.shutdownHook,void 0)),Ee))))}publish(t){return b(()=>c(this.shutdownFlag)?f:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),d(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,st(t),this.shutdownFlag))}isActive(){return!c(this.shutdownFlag)}unsafeOffer(t){return c(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return b(()=>{if(c(this.shutdownFlag))return f;const s=vs(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),rt(s)?d(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,s,this.shutdownFlag)})}get subscribe(){const t=nt(it([this.scope.fork(at),hs(this.pubsub,this.subscribers,this.strategy)]),s=>s[0].addFinalizer(()=>s[1].shutdown));return w(ot(t,(s,r)=>s[0].close(r)),s=>s[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return H(this,arguments)}}const ys=(e,t)=>U(Ze(),s=>w(ge(),r=>ws(e,new Map,s,r,ye(!1),t))),ws=(e,t,s,r,n,i)=>new gs(e,t,s,r,n,i),xs=(e,t)=>{pt(e,d(t))},ze=(e,t)=>l(e,ts(t)),Z=e=>l(e,ss(Number.POSITIVE_INFINITY)),Ss=e=>e.pollUpTo(Number.POSITIVE_INFINITY),Es=(e,t)=>e.pollUpTo(t),vs=(e,t)=>e.publishAll(t),ks=(e,t)=>{ze(e,l(Z(e),ht(s=>s!==t)))};class _s{get shutdown(){return bt}handleSurplus(t,s,r,n){return d(!1)}unsafeOnPubSubEmptySpace(t,s){}unsafeCompletePollers(t,s,r,n){return Ns(this,t,s,r,n)}unsafeCompleteSubscribers(t,s){return Ts(this,t,s)}}const Ns=(e,t,s,r,n)=>{let i=!0;for(;i&&!r.isEmpty();){const u=l(n,He(m));if(u===m)l(s,us(r,n)),F(n)?i=!1:l(s,Ue(r,n));else{const h=r.poll(m);h===m?ze(n,l(Z(n),j(u))):(xs(u,h),e.unsafeOnPubSubEmptySpace(t,s))}}},Ts=(e,t,s)=>{for(const[r,n]of s)for(const i of n)e.unsafeCompletePollers(t,s,r,i)};class Cs{constructor(t){o(this,"capacity");o(this,"head",{value:p,next:null});o(this,"tail",this.head);o(this,"size",0);o(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:p,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const s of t)this.offer(s)}}class Bs{constructor(t){o(this,"buffer");o(this,"head");o(this,"index");o(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return g();this.index<this.buffer.index&&this.fastForward();const s=Math.min(t,this.remaining),r=new Array(s);for(let n=0;n<s;n++){const i=this.head.value;this.head=this.head.next,r[n]=i}return this.remaining-=s,et(r)}takeAll(){return this.takeN(this.remaining)}}const Is={remaining:0,take:()=>{},takeN:()=>g(),takeAll:()=>g()},Ps=ls,Fs=cs,$s=jt();class O extends Ne()("BotStateProvider",{defaultValue:()=>$s({name:"nameless",status:"idle",token:"",isAutoReload:!1,isReachable:!1,currentCode:"",events:[]})}){}const As="0.6.2",$="@effect-ak/tg-bot-client",ue="mjs",E="https://cdn.jsdelivr.net/npm",v=`${$}@${As}/dist`,Hs=[{entryName:"index",packageName:$,dts_url:`${E}/${v}/index.d.ts`,js_url:`${E}/${v}/index.${ue}`},{entryName:"bot",packageName:$,dts_url:`${E}/${v}/bot.d.ts`,js_url:`${E}/${v}/bot-bundle.${ue}`},{entryName:"config-BFdBOrJI",packageName:$,dts_url:`${E}/${v}/config-BFdBOrJI.d.ts`}];class Me extends V()("TgBotEditorProvider",{scoped:J(function*(t){const s=yield*se,r=yield*re,n=yield*ne("/bots/empty.ts"),i=yield*O;r.model.setValue(n),i.currentCode=n;const u=async h=>{console.log("setting code");const y=await ne(`/bots/${h}`).pipe(R);r.model.setValue(y),i.currentCode=n};return yield*G(h=>(console.log("editor finalizer",h),Q)),{getCode:r.getCode,bindEditor:s.bindEditor,changeExample:u}}),dependencies:[se.Default.pipe(mt(re.typescript),Te(gt(yt,{packages:Hs})))]}){}const Rs=Ce("create pub sub")(function*(){const e=yield*Ps();return yield*G(()=>Fs(e)),e});class C extends V()("PlaygroundBusProvider",{scoped:Rs()}){}function qe(e){return!(e.type=="new-active-tab"||e.type=="from-worker"&&e.data.newBotState)}const Os=T({type:S("error-encounter"),error:K}),Us=T({type:S("bot-code-changed"),new_code:K}),Ws=T({type:S("bot-is-connected")}),zs=T({type:S("new-active-tab"),tabName:S("run","code")}),De=T({type:S("from-worker"),data:wt({key:K,value:Et}),message_id:xt});St(Os,Us,De,Ws,zs);class Le extends V()("BotWorkerProvider",{scoped:J(function*(t){yield*vt("worker up");const s=new Worker(new URL(""+new URL("web-worker-C4B132UW.js",import.meta.url).href,import.meta.url),{type:"module"}),r=yield*O;return yield*G(n=>(s.terminate(),console.log("terminating worker",n),Q)),s.addEventListener("message",n=>{console.log("message from worker",n.data);const i=kt(De)(n.data);if(i._tag!="Right"||!qe(i.right)){console.log("ignoring web worker event",n);return}r.events.push(i.right)}),{runBot(){s.postMessage({command:"run-bot",code:r.currentCode,token:r.token})}}}),dependencies:[C.Default]}){}const je=a.createContext(null),Ms=_t(Me.Default,C.Default,Le.Default).pipe(Te(Nt)),qs=Tt(Ms),Ds=async()=>{const e=await qs.runtimeEffect.pipe(R),t=P(e.context,Me),s=P(e.context,C),r=P(e.context,O);return{botWorker:P(e.context,Le),eventBus:s,botState:r,editor:t,subscribe(i){console.log("subscribing...");const u=J(function*(){const y=yield*Ct(),I=yield*l(s.subscribe,X(Bt,y)),Je=yield*l(I.take,Be(i),Pt,It(y));return{subscription:I,fiber:Je,close:()=>l(At(y,Ht),$t).then(Ge=>console.log("cleaning up scope",Ge))}}),{close:h}=Ft(u);return()=>{console.log("closing scope..."),h()}}}};class Ls extends Rt.PureComponent{constructor(t){super(t),this.$=a.createRef(),this._=a.createRef()}render(){return a.createElement("span",{ref:this.$},a.createElement("a",{...this.props,ref:this._},this.props.children))}componentDidMount(){this.paint()}getSnapshotBeforeUpdate(){return this.reset(),null}componentDidUpdate(){this.paint()}componentWillUnmount(){this.reset()}paint(){const t=this.$.current.appendChild(document.createElement("span"));Ot(async()=>{const{render:s}=await import("./buttons.esm-DK2fWHEW.js");return{render:s}},[],import.meta.url).then(({render:s})=>{this._.current!=null&&s(t.appendChild(this._.current),function(r){try{t.parentNode.replaceChild(r,t)}catch{}})})}reset(){this.$.current.replaceChild(this._.current,this.$.current.lastChild)}}var x=class extends Ut("TgBotClientError"){},js=e=>typeof e=="object"&&e!=null&&"file_content"in e&&e.file_content instanceof Uint8Array&&"file_name"in e&&typeof e.file_name=="string",Vs=e=>typeof e=="object"&&e!=null&&"ok"in e&&typeof e.ok=="boolean",Js="https://api.telegram.org",Ve=class extends Ne()("TgBotApiBaseUrl",{defaultValue:()=>Js}){},ee=class extends Ie("TgBotApiToken")(){},Gs=e=>{let t=Object.entries(e);if(t.length==0)return;let s=new FormData;for(let[r,n]of t)n&&(typeof n!="object"?s.append(r,`${n}`):js(n)?s.append(r,new Blob([n.file_content]),n.file_name):s.append(r,JSON.stringify(n)));return s},D=(e,t)=>Y(function*(){let s=yield*A(ee),r=yield*A(Ve),n=yield*M({try:()=>fetch(`${r}/bot${s}/${rs(e)}`,{body:Gs(t)??null,method:"POST"}),catch:u=>new x({cause:{_tag:"ClientInternalError",cause:u}})}),i=yield*M({try:()=>n.json(),catch:()=>new x({cause:{_tag:"NotJsonResponse",response:n}})});return Vs(i)?n.ok?i.result:yield*q(new x({cause:{_tag:"NotOkResponse",...i.error_code?{errorCode:i.error_code}:void 0,...i.description?{details:i.description}:void 0}})):yield*q(new x({cause:{_tag:"UnexpectedResponse",response:i}}))}),Qs=({fileId:e,type:t})=>Ks(e).pipe(Wt(({content:s,file_name:r})=>new File([s],r,{...t?{type:t}:void 0}))),Ks=e=>Y(function*(){let t=(yield*D("get_file",{file_id:e})).file_path;if(!t||t.length==0)return yield*q(new x({cause:{_tag:"UnableToGetFile",cause:"File path not defined"}}));let s=t.replaceAll("/","-"),r=yield*A(Ve),n=yield*A(ee),i=`${r}/file/bot${n}/${t}`;return{content:yield*M({try:()=>fetch(i).then(u=>u.arrayBuffer()),catch:u=>new x({cause:{_tag:"UnableToGetFile",cause:u}})}),file_name:s}});(class extends Ie("ClientFileService")(){});Y(function*(){return{getFile:Qs}});const Xs=Ce("setup bot token")(function*(e){console.log("setup bot token");const t=yield*O,s=yield*C,r=yield*l(qt({me:D("get_me",{}),webhook:D("get_webhook_info",{})},{concurrency:"unbounded"}),Mt(n=>s.offer({type:"error-encounter",error:n.toString()}).pipe(Be(Q))),Pe(zt("1 second")));return r?r.webhook.url?(s.unsafeOffer({type:"error-encounter",error:"Cannot work with webhooks, delete it first"}),!1):(t.name=r.me.username??r.me.first_name,t.isReachable=!0,t.token=e,s.unsafeOffer({type:"bot-is-connected"}),!0):!1},(e,t)=>e.pipe(X(ee,t)));function Ys(){const e=B(),[t,s]=a.useState(e.botState);return{botState:t,setToken:async r=>{const n=await Xs(r).pipe(X(C,e.eventBus),R);s({...e.botState}),n&&e.botWorker.runBot()}}}function B(){const e=a.useContext(je);if(!e)throw Error("Playground context is undefined");return e}function Zs(e){return a.createElement("button",{type:"button",className:"px-3 py-1 border rounded hover:bg-gray-200 active:bg-gray-300",onClick:()=>e.click()},a.createElement("i",{className:`fas fa-${e.icon}`}))}function er(){const{setToken:e,botState:t}=Ys(),[s,r]=a.useState(!1);if(t.token&&t.name){const i=`tg://resolve?domain=${t.name}`;return a.createElement(a.Fragment,null,a.createElement("span",{className:"text-green-700"},"Connected:"),a.createElement("a",{className:"hover:text-blue-700",href:i},"@",t.name))}const n=async()=>{const i=prompt("Enter your Telegram bot token (from BotFather) to connect the bot");i&&(r(!0),await e(i),r(!1))};return a.createElement("div",{className:"flex gap-2"},!s&&a.createElement("span",{className:"text-lg text-red-600"},"Not connected"),s&&a.createElement("span",{className:"text-lg"},"Connecting... ",a.createElement("i",{className:"fas fa-cog fa-spin"})),!s&&a.createElement(Zs,{icon:"plug",click:n}))}function tr(){const e=B(),[t,s]=a.useState(e.botState.events);return a.useEffect(()=>{e.editor.getCode().pipe(Pe(n=>{e.botState.currentCode=n,e.botState.isReachable&&e.botWorker.runBot()}),R);const r=e.subscribe(n=>{qe(n)&&(s(i=>[...i,n]),e.botState.events.push(n))});return()=>{console.log("leaving run tab"),r()}},[e]),a.createElement("div",{id:"run",className:"flex flex-col h-full"},a.createElement("div",{className:"flex mb-2 text-sm gap-2"},a.createElement(er,null)),a.createElement("div",{className:"flex flex-1 flex-col items-start justify-start overflow-y-auto hide-scrollbar border border-gray-400 bg-indigo-50"},t.map((r,n)=>a.createElement("div",{key:n,className:"w-full px-4 py-2 text-sm whitespace-pre-wrap text-black border-b-black border-b border-dotted"},JSON.stringify(r)))))}function sr(){const e=B();return a.useEffect(()=>{const t=e.editor.bindEditor();return t.layout({height:500,width:10}),()=>{t.dispose()}},[e]),a.createElement("div",{id:"code-editor",className:"border border-gray-400"})}function rr(){const{eventBus:e}=B(),[t,s]=a.useState("code"),r=["code","run"];function n(i){s(i),e.unsafeOffer({type:"new-active-tab",tabName:i})}return a.createElement("div",{className:"flex gap-2.5 h-full"},a.createElement("div",{className:"w-20"},r.map(i=>a.createElement("button",{key:i,className:`transition block mb-2 px-4 py-2 rounded ${t===i?"bg-gray-200":"hover:bg-gray-200"}`,onClick:()=>n(i)},i))),a.createElement("div",{className:"flex flex-1 flex-col w-full h-[600px]"},t==="code"&&a.createElement(sr,null),t==="run"&&a.createElement(tr,null)))}function nr(){const[e,t]=a.useState("empty.ts"),s=B(),r=n=>{const i=n.target.value;t(i),s.editor.changeExample(i)};return a.createElement("div",{className:"flex items-start gap-2.5 mb-4"},a.createElement("label",{className:"flex items-center gap-2"},"Select example",a.createElement("select",{className:"px-2 py-1 border border-gray-300 rounded bg-white",value:e,onChange:r},a.createElement("option",{value:"empty.ts"},"Simple Bot"),a.createElement("option",{value:"command.ts"},"Command Bot"),a.createElement("option",{value:"file.ts"},"File Bot"))))}function ir(){return a.createElement(Ls,{href:"https://github.com/effect-ak/tg-bot-client","data-color-scheme":"no-preference: light; light: light; dark: dark;","data-icon":"octicon-star","data-size":"large","data-show-count":"true","aria-label":"Star effect-ak/tg-bot-client on GitHub"},"Star")}function ar(){return a.createElement(a.Fragment,null,a.createElement("div",{className:"flex mb-6 gap-2"},a.createElement("span",{className:"text-xl font-bold text-start text-gray-800"},"Build and test Telegram bots in your browser"),a.createElement(ir,null)),a.createElement(nr,null),a.createElement(rr,null),a.createElement(Lt,null))}function or(e){const t=document.getElementById("playground");if(!t){console.warn("root div container");return}Dt.createRoot(t).render(a.createElement(a.StrictMode,null,a.createElement(je,{value:e},a.createElement(ar,null))))}async function ur(){const e=await Ds();or(e)}ur();
